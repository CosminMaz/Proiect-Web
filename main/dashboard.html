<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panou utilizator</title>
  <link rel="stylesheet" href="../assets/style.css">
  <link rel="stylesheet" href="../assets/dashboard.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
  <style>
    #map {
      height: 500px;
      margin: 2rem auto;
      max-width: 95%;
      border-radius: 10px;
      border: 2px solid #ccc;
    }

    .map-controls {
      text-align: center;
      margin: 1rem;
    }

    .map-controls input,
    .map-controls button {
      padding: 0.5rem;
      font-size: 1rem;
      margin-right: 10px;
    }
  </style>
</head>
<body>

<header id="navbar">
  <div class="logo">DASHBOARD | CAM Real Estate</div>
  <nav>
    <ul>
      <li><a href="#">AcasÄƒ</a></li>
      <li><a href="#" id="logoutBtn">Delogare</a></li>
    </ul>
  </nav>
</header>

<section class="hero">
  <h1 id="userInfo"></h1>
</section>

<section class="apartments">
  <h2 class="titlu-chirii">AnunÈ›urile tale</h2>
  <div class="apartment-list" id="myListings">
  </div>
</section>

<!-- Filtru È™i HartÄƒ -->
<div class="map-controls">
  <form id="filterForm">
    <label for="priceRange">PreÈ› maxim (â‚¬):</label>
    <input type="number" id="priceRange" name="priceRange" value="100000" min="0"/>
    <button type="submit">FiltreazÄƒ</button>
  </form>
</div>
<div id="map"></div>

<footer class="site-footer">
  <div class="footer-container">
    <div class="footer-logo">
      <h2>CAM Real Estate</h2>
      <p>GÄƒseÈ™te locuinÈ›a idealÄƒ, rapid È™i sigur.</p>
    </div>
    <div class="footer-links">
      <h3>Linkuri rapide</h3>
      <ul>
        <li><a href="#">AcasÄƒ</a></li>
        <li><a href="#">Contul meu</a></li>
        <li><a href="#">AdaugÄƒ anunÈ›</a></li>
        <li><a href="#">Ajutor</a></li>
      </ul>
    </div>
    <div class="footer-contact">
      <h3>Contact</h3>
      <p>ðŸ“ž 0784 265 890</p>
      <p>ðŸ“§ contact@camrealestate.ro</p>
    </div>
    <div class="footer-social">
      <h3>UrmÄƒreÈ™te-ne</h3>
      <div class="social-icons">
        <a href="#"><img src="../assets/icons/facebook-circle.svg" alt="Facebook"></a>
        <a href="#"><img src="../assets/icons/iconmonstr-instagram-11.svg" alt="Instagram"></a>
      </div>
    </div>
  </div>
  <div class="footer-bottom">
    <p>&copy; 2025 CAM Real Estate. Toate drepturile rezervate.</p>
  </div>
</footer>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="../assets/dashboard.js"></script>
<script>
  const map = L.map('map').setView([45.9432, 24.9668], 6); // RomÃ¢nia

  const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  const properties = [
    { lat: 44.4268, lng: 26.1025, price: 95000, description: "Apartament 2 camere, BucureÈ™ti" },
    { lat: 46.7704, lng: 23.5914, price: 120000, description: "CasÄƒ Ã®n Cluj" },
    { lat: 47.1585, lng: 27.6014, price: 85000, description: "GarsonierÄƒ Ã®n IaÈ™i" }
  ];

  let propertyMarkers = [];

  function updateMarkers(maxPrice) {
    propertyMarkers.forEach(marker => map.removeLayer(marker));
    propertyMarkers = [];

    properties.forEach(p => {
      if (p.price <= maxPrice) {
        const marker = L.marker([p.lat, p.lng]).addTo(map);
        marker.bindPopup(`<b>${p.description}</b><br>PreÈ›: â‚¬${p.price}`);
        propertyMarkers.push(marker);
      }
    });
  }

  updateMarkers(100000);

  document.getElementById('filterForm').addEventListener('submit', function (e) {
    e.preventDefault();
    const maxPrice = parseInt(document.getElementById('priceRange').value, 10);
    updateMarkers(maxPrice);
  });

  // Geolocalizare
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(pos => {
      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;

      const userMarker = L.marker([lat, lng], { color: 'green' }).addTo(map);
      userMarker.bindPopup("LocaÈ›ia ta curentÄƒ").openPopup();
      map.setView([lat, lng], 13);

      const nearby = properties.filter(p => map.distance([lat, lng], [p.lat, p.lng]) < 20000);
      nearby.forEach(p => {
        const marker = L.circleMarker([p.lat, p.lng], { color: 'red' }).addTo(map);
        marker.bindPopup(`<b>${p.description}</b><br>PreÈ›: â‚¬${p.price}<br><i>(Ã®n apropiere)</i>`);
      });
    });
  }

  // Strat: parcÄƒri
  const parkingLayer = L.layerGroup();
  L.circle([44.4325, 26.1039], { radius: 100, color: 'blue' }).bindPopup("Parcare PiaÈ›a Victoriei").addTo(parkingLayer);
  L.circle([46.7712, 23.6236], { radius: 100, color: 'blue' }).bindPopup("Parcare Cluj Central").addTo(parkingLayer);

  L.control.layers({ "OpenStreetMap": osmLayer }, { "ParcÄƒri": parkingLayer }).addTo(map);
</script>

</body>
</html>
